release-docker:
    just build-plugin
    docker build . -t mdoj-judger

build-plugin:
    cd plugins && sh build-all.sh

build-nsjail:
    TARGET=x86_64-linux-musl
    cd nsjail && make

build-nsjail-musl:
    MUSL_TARGET=x86_64-linux-musl
    echo todo!()

prepare:
    mkdir -p .temp

debian-deps:
    echo todo!()

feodra-deps:
    sudo dnf install protobuf-devel autoconf gettext libtool gcc libcap-devel systemd-devel yajl-devel libgcrypt-devel glibc-static libseccomp-devel python36 git

clean:
    sudo rm -rf .temp/* 
    cargo clean

test:
    sudo rm -rf .temp/* 
    cargo test --no-fail-fast -- --test-threads 1 

run:
    sudo rm -rf .temp/* 
    cargo run

podman-run:
    # recreate cgroup of mdoj for normal user
    sudo rm -rf /sys/fs/cgroup/mdoj
    sudo cgcreate -a $USER -t $USER -g memory,cpu,cpuset:mdoj
    # run podman
    podman-compose up
